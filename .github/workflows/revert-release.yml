name: Publish Existing Tag

on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Enter the existing tag version to publish (e.g., v1.0.0)'
        required: true

jobs:
  publish-existing-tag:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout Repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      # Step 2: Fetch All Tags
      - name: Fetch Tags
        run: git fetch --tags

      # Step 3: Verify Specified Tag Exists
      - name: Verify Tag Exists
        run: |
          if ! git rev-parse ${{ github.event.inputs.tag_name }} >/dev/null 2>&1; then
            echo "Error: Specified tag does not exist."
            exit 1
          fi
        shell: bash

      # Step 4: Publish Existing Tag as a Release
      - name: Publish Existing Tag as Release
        uses: actions/create-release@v1
        with:
          tag_name: ${{ github.event.inputs.tag_name }}
          release_name: "Release ${{ github.event.inputs.tag_name }}"
          body: |
            This release was created for the existing tag ${{ github.event.inputs.tag_name }}.
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # Step 4: Install Dependencies and Build
      - name: Build the Project
        run: |
          npm install
          npm run build

      # Step 5: Deploy to CDN
      - name: Deploy to CDN
        env:
          CDN_API_KEY: ${{ secrets.CDN_API_KEY }}
        run: |
          # Replace this with your CDN deployment script
          deploy_to_cdn ./build
          echo "Deployed version ${{ github.event.inputs.tag_name }} to the live CDN path."